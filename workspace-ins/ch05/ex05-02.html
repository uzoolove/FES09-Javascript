<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Javascript Lab</title>
<link rel="shortcut icon" href="../../favicon.ico">
<script>
	window.onload = function(){
		document.querySelector('button').onclick = function(){
      getTime();
      getTimeJson();
    };
	};
  
  // method: GET
  // url: /time
  // querystring: msg=time
  // 서버의 응답 포맷: Text
	function getTime(){
		// 1. XMLHttpRequest 생성		
		var xhr = new XMLHttpRequest();
		// 2. 요청준비(open())
    xhr.open('get', 'http://localhost:33080/time?msg=time&delay=5000', true);
    xhr.onload = function(){
      // 4. 응답 데이터 처리
      var result = this.responseText;
      append(result);
    };
		// 3. 요청(send())
    xhr.send();
	};

  // method: POST
  // url: /timejson
  // body: {msg: 'timejson'}
  // 서버의 응답 포맷: JSON
	function getTimeJson(){
    const body = {msg: 'timejson', delay: 1000};
    // 1. XMLHttpRequest 생성		
		var xhr = new XMLHttpRequest();
		// 2. 요청준비(open())
		xhr.open('post', 'http://localhost:33080/timejson', true);
    xhr.onload = function(){
      // 4. 응답 데이터 처리
      var result = xhr.responseText;
      result = JSON.parse(result);
      appendJson(result);
    };
		// 3. 요청(send())
    xhr.send(JSON.stringify(body));
  }
  
	function append(str){
		document.querySelector('#result').innerHTML += str + '<br>';
	}
	
	function appendJson(obj){
		document.querySelector('#result').innerHTML += obj.msg + ' ' + obj.time + '<br>';
	}
</script>
</head>
<body>
	<h1>AJAX 통신(XMLHttpRequest 사용)</h1>
	<input type="text">
	<button>서버시간요청</button>
	<div id="result"></div>
</body>
</html>